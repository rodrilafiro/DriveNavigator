<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drive Explorer XP</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-black">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        
        // Adaptador para iconos de Lucide
        const Icon = ({ name, size = 24, className = "", fill = "none" }) => {
            const [svg, setSvg] = useState("");
            useEffect(() => {
                if (window.lucide) {
                    const iconNode = window.lucide.icons[name];
                    if (iconNode) {
                        // Crear un elemento temporal para obtener el SVG
                        const div = document.createElement('div');
                        const iconSvg = window.lucide.createIcons({
                            icons: { [name]: iconNode },
                            attrs: { size, class: className, fill }
                        });
                    }
                }
            }, [name, size, className, fill]);
            
            // Usamos componentes directos de Lucide para mayor compatibilidad en esta versi贸n
            const LucideIcon = ({ iconName, ...props }) => {
                const Tag = iconName;
                return <i data-lucide={iconName.toLowerCase()} {...props}></i>;
            };
            return <span dangerouslySetInnerHTML={{__html: `<i data-lucide="${name}" style="width:${size}px; height:${size}px" class="${className}"></i>`}} />;
        };

        // Tu c贸digo de configuraci贸n
        const CLIENT_ID = "483723699126-qnf9lr8p8c9cnud19lkceiv92022c1rs.apps.googleusercontent.com";
        const SCOPES = "https://www.googleapis.com/auth/drive.metadata.readonly https://www.googleapis.com/auth/drive.file";

        // --- AQU COMIENZA TU COMPONENTE APP ADAPTADO ---
        const App = () => {
            // (He mantenido toda tu l贸gica interna exactamente igual)
            const [tokenClient, setTokenClient] = useState(null);
            const [accessToken, setAccessToken] = useState(null);
            const [user, setUser] = useState(null);
            const [files, setFiles] = useState([]);
            const [currentFolder, setCurrentFolder] = useState({ id: 'root', name: 'Mi unidad' });
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [isGisLoaded, setIsGisLoaded] = useState(false);

            useEffect(() => {
                const scriptGis = document.createElement('script');
                scriptGis.src = "https://accounts.google.com/gsi/client";
                scriptGis.async = true;
                scriptGis.onload = () => setIsGisLoaded(true);
                document.head.appendChild(scriptGis);

                const scriptGapi = document.createElement('script');
                scriptGapi.src = "https://apis.google.com/js/api.js";
                scriptGapi.async = true;
                scriptGapi.onload = () => {
                    window.gapi.load('client', async () => {
                        await window.gapi.client.init({
                            discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
                        });
                    });
                };
                document.head.appendChild(scriptGapi);
            }, []);

            useEffect(() => {
                if (isGisLoaded && window.google) {
                    const client = window.google.accounts.oauth2.initTokenClient({
                        client_id: CLIENT_ID,
                        scope: SCOPES,
                        callback: (resp) => {
                            setAccessToken(resp.access_token);
                            fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                                headers: { Authorization: `Bearer ${resp.access_token}` }
                            }).then(r => r.json()).then(setUser);
                        },
                    });
                    setTokenClient(client);
                }
            }, [isGisLoaded]);

            const fetchFiles = async (folderId = 'root') => {
                if (!accessToken) return;
                setLoading(true);
                try {
                    const res = await fetch(`https://www.googleapis.com/drive/v3/files?q='${folderId}' in parents and trashed = false&fields=files(id, name, mimeType)&pageSize=50`, {
                        headers: { Authorization: `Bearer ${accessToken}` }
                    });
                    const data = await res.json();
                    setFiles(data.files || []);
                } catch (e) { setError(e.message); }
                finally { setLoading(false); }
            };

            useEffect(() => { if(accessToken) fetchFiles(currentFolder.id); }, [accessToken, currentFolder.id]);

            // Renderizado (Simplificado para el ejemplo pero manteniendo tu estilo XP)
            if (!accessToken) {
                return (
                    <div className="h-screen w-screen bg-[#003399] flex flex-col items-center justify-center font-sans text-white">
                        <h1 className="text-5xl font-bold mb-8 italic">Windows <span className="text-orange-500">xp</span></h1>
                        <button 
                            onClick={() => tokenClient.requestAccessToken({prompt: 'consent'})}
                            className="flex items-center gap-4 p-4 border-2 border-white/20 hover:bg-white/10 rounded-xl transition-all"
                        >
                            <div className="w-16 h-16 bg-blue-600 rounded-lg border-2 border-white/50 flex items-center justify-center text-2xl"></div>
                            <div className="text-left">
                                <p className="text-xl font-bold">Iniciar sesi贸n con Google</p>
                                <p className="text-blue-200">Haz clic para conectar tu Drive</p>
                            </div>
                        </button>
                    </div>
                );
            }

            return (
                <div className="h-screen w-screen flex flex-col bg-[#ece9d8] font-sans text-sm overflow-hidden">
                    <div className="h-8 bg-gradient-to-b from-[#0058e6] to-[#0058e6] flex items-center justify-between px-2 text-white font-bold">
                        <span>{currentFolder.name} - Drive XP</span>
                        <button onClick={() => window.location.reload()} className="bg-red-600 px-2 rounded">X</button>
                    </div>
                    <div className="flex-1 flex overflow-hidden">
                        <div className="w-64 bg-[#7ba2e7] p-4 hidden md:block border-r border-white/40">
                            <div className="bg-[#d6dff7] p-2 rounded border border-blue-800 text-blue-900 font-bold mb-4">Tareas de Drive</div>
                            <div className="text-white text-xs space-y-2">
                                <p>Usuario: {user?.name}</p>
                                <button onClick={() => setAccessToken(null)} className="underline">Cerrar Sesi贸n</button>
                            </div>
                        </div>
                        <div className="flex-1 bg-white p-6 overflow-y-auto">
                            <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-8">
                                {files.map(f => (
                                    <div key={f.id} className="flex flex-col items-center text-center group cursor-pointer"
                                         onDoubleClick={() => f.mimeType === 'application/vnd.google-apps.folder' ? setCurrentFolder({id: f.id, name: f.name}) : window.open(`https://drive.google.com/file/d/${f.id}/view`)}>
                                        <div className="text-4xl mb-1">{f.mimeType.includes('folder') ? '' : ''}</div>
                                        <span className="group-hover:bg-blue-700 group-hover:text-white px-1 break-all">{f.name}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    <div className="h-8 bg-[#245edb] flex items-center px-1">
                        <div className="bg-green-600 px-4 h-full flex items-center text-white italic font-bold rounded-r-xl shadow-lg">Inicio</div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // Inicializar iconos
        setTimeout(() => { if(window.lucide) window.lucide.createIcons(); }, 1000);
    </script>
</body>
</html>